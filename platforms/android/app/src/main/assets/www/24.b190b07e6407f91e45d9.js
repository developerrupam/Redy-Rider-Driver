(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{bNZI:function(n,t,l){"use strict";l.r(t);var o=l("CcnG"),e=l("mrSG"),i=l("gTw3"),a=l("ZZ/e"),r=l("23JA"),u=l("UNbJ"),c=l("k82s"),s=l("67Y/"),p=function(){function n(n,t,l,o,e,i,a,r,u){var c=this;this.navCtrl=n,this.plt=t,this.geolocation=l,this.storage=o,this.nativeGeocoder=e,this.backgroundGeolocation=i,this.afAuth=a,this.afs=r,this.localNotifications=u,this.arr=[],this.user=null,this.currentMapTrack=null,this.markers=[],this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[],this.loc=[],this.geoencoderOptions={useLocale:!0,maxResults:5},console.log("constructor"),this.storage.get("USER_INFO").then(function(n){n&&c.anonLogin(n.user_account_no+"-"+n.name+"-"+new Date)})}return n.prototype.ngOnInit=function(){var n=this;console.log("ngOnInit"),this.backgroundGeolocation.configure({desiredAccuracy:10,stationaryRadius:20,interval:6e4,distanceFilter:30,debug:!0,stopOnTerminate:!1}).then(function(){n.backgroundGeolocation.on(u.b.location).subscribe(function(t){console.log(t),n.map=new google.maps.LatLng(t.latitude,t.longitude),n.map.setZoom(18),n.storage.get("trackingLocations").then(function(l){var o=l;l?(o.push(t),n.storage.set("trackingLocations",o)):(n.arr.push(t),n.storage.set("trackingLocations",n.arr))}),n.backgroundGeolocation.finish()})})},n.prototype.ionViewDidEnter=function(){console.log("ionViewDidEnter"),this.plt.ready().then(function(){})},n.prototype.ionViewWillEnter=function(){console.log("ionViewWillEnter"),this.loadMap()},n.prototype.loadMap=function(){var n=this;this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:-34.9011,lng:-56.1645},zoom:18,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0}),this.geolocation.getCurrentPosition().then(function(t){var l={lat:t.coords.latitude,lng:t.coords.longitude},o=new google.maps.Marker({position:l,map:n.map,title:"you are here!"});n.markers.push(o),n.map.setCenter(l),n.map.setZoom(18)}).catch(function(n){console.log("Error getting location",n)})},n.prototype.anonLogin=function(n){var t=this;this.afAuth.auth.signInAnonymously().then(function(l){t.locationsCollection=t.afs.collection("locations/"+n+"/track",function(n){return n.orderBy("timestamp")}),t.locations=t.locationsCollection.snapshotChanges().pipe(Object(s.a)(function(n){return n.map(function(n){var t=n.payload.doc.data();return e.__assign({id:n.payload.doc.id},t)})})),console.log("this.locations",t.locations),t.locations.subscribe(function(n){console.log("new location: ",n),t.loc=n,t.updateMap(n)})})},n.prototype.updateMap=function(n){if(n.length>1){this.markers.map(function(n){return n.setMap(null)}),this.markers=[];for(var t=0,l=n;t<l.length;t++){var o=l[t],e=new google.maps.LatLng(o.lat,o.lng),i=new google.maps.Marker({map:this.map,position:e});this.markers.push(i)}}},n.prototype.addNewLocation=function(n,t,l,o){this.locationsCollection.add({lat:n,lng:t,timestamp:l,address:o})},n.prototype.deleteLocation=function(n){this.locationsCollection.doc(n.id).delete()},n.prototype.registerNotification=function(n){this.localNotifications.schedule({title:"my "+n+" notification",text:"Saha Local Notification",trigger:{in:n,unit:c.a.SECOND}})},n.prototype.startTracking=function(){var n=this,t=1;this.trackedRoute=[],this.watch=this.geolocation.watchPosition().subscribe(function(l){console.log("new position: ",l),l&&(n.getGeoencoder(l.coords.latitude,l.coords.longitude),console.log("geoaddress",n.geoAddress),n.addNewLocation(l.coords.latitude,l.coords.longitude,l.timestamp,n.geoAddress?n.geoAddress:"from desktop"),n.trackedRoute.push({lat:l.coords.latitude,lng:l.coords.longitude,address:n.geoAddress,point_number:t}),t++,n.redrawPath(n.trackedRoute))})},n.prototype.stopTracking=function(){this.watch.unsubscribe(),this.currentMapTrack.setMap(null)},n.prototype.GetLocations=function(){this.redrawPath(this.loc)},n.prototype.getGeoencoder=function(n,t){var l=this;console.log("latitude",n),this.nativeGeocoder.reverseGeocode(n,t,this.geoencoderOptions).then(function(n){console.log("result[0]",n[0]),l.geoAddress=l.generateAddress(n[0]),console.log("this.geoAddress",l.geoAddress)}).catch(function(n){alert("Error getting location"+JSON.stringify(n))})},n.prototype.generateAddress=function(n){console.log("addressObj",n);var t=[],l="";for(var o in n)t.push(n[o]);for(var e in t.reverse(),t)t[e].length&&(l+=t[e]+", ");return console.log("address.slice(0, -2);",l.slice(0,-2)),l.slice(0,-2)},n.prototype.redrawPath=function(n){console.log("path",n),this.currentMapTrack&&this.currentMapTrack.setMap(null),n.length>1&&(console.log("currentMapTrack"),this.currentMapTrack=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#7044ff",strokeOpacity:1,strokeWeight:3}),this.currentMapTrack.setMap(this.map),console.log("dfddsfsdsf"))},n.prototype.showHistoryRoute=function(n){console.log(n),this.redrawPath(n)},n}(),b=function(){return function(){}}(),d=l("pMnS"),g=l("bAmN"),h=l("oBZk"),f=l("Ip0R"),m=l("jWFl"),k=l("OOyK"),y=l("ZYCi"),w=l("iw74"),v=l("jKJn"),q=l("xoVG"),M=l("Ht5U"),z=l("ZgVV"),T=l("cGva"),L=l("ZBkt"),C=l("fvl4"),O=o.ob({encapsulation:0,styles:[["#map[_ngcontent-%COMP%]{width:100%;height:450px}#markerLayer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{animation:.5s infinite alternate pulse;-webkit-animation:.5s infinite alternate pulse;transform-origin:center;-webkit-transform-origin:center}"],g.a],data:{}});function A(n){return o.Kb(0,[(n()(),o.qb(0,0,null,null,14,"ion-row",[],null,null,null,h.wb,h.G)),o.pb(1,49152,null,0,a.kb,[o.h,o.k,o.z],null,null),(n()(),o.qb(2,0,null,0,12,"ion-col",[],null,null,null,h.Y,h.i)),o.pb(3,49152,null,0,a.v,[o.h,o.k,o.z],null,null),(n()(),o.qb(4,0,null,0,1,"p",[],null,null,null,null,null)),(n()(),o.Ib(5,null,["Lat: ",""])),(n()(),o.qb(6,0,null,0,1,"p",[],null,null,null,null,null)),(n()(),o.Ib(7,null,["Lng: ",""])),(n()(),o.qb(8,0,null,0,2,"p",[],null,null,null,null,null)),(n()(),o.Ib(9,null,[" "," "])),o.Eb(10,2),(n()(),o.qb(11,0,null,0,1,"p",[],null,null,null,null,null)),(n()(),o.Ib(12,null,[" "," "])),(n()(),o.qb(13,0,null,0,1,"button",[["clear",""],["ion-button",""],["item-end",""]],null,[[null,"click"]],function(n,t,l){var o=!0,e=n.component;return"click"===t&&(o=!1!==e.showHistoryRoute(e.locations)&&o),o},null,null)),(n()(),o.Ib(-1,null,["View Route"]))],null,function(n,t){n(t,5,0,t.context.$implicit.lat),n(t,7,0,t.context.$implicit.lng);var l=o.Jb(t,9,0,n(t,10,0,o.Ab(t.parent,0),t.context.$implicit.timestamp,"short"));n(t,9,0,l),n(t,12,0,t.context.$implicit.address)})}function G(n){return o.Kb(0,[o.Cb(0,f.e,[o.u]),o.Gb(402653184,1,{mapElement:0}),(n()(),o.qb(2,0,null,null,1,"app-header",[],null,null,null,m.b,m.a)),o.pb(3,114688,null,0,k.a,[y.m,a.f,w.b,v.a,q.a,M.a,z.a,T.a],null,null),(n()(),o.qb(4,0,null,null,27,"ion-content",[],null,null,null,h.Z,h.j)),o.pb(5,49152,null,0,a.w,[o.h,o.k,o.z],null,null),(n()(),o.qb(6,0,[[1,0],["map",1]],0,0,"div",[["id","map"]],null,null,null,null,null)),(n()(),o.qb(7,0,null,0,4,"ion-button",[["color","tertiary"],["size","default"],["type","button"]],null,[[null,"click"]],function(n,t,l){var o=!0;return"click"===t&&(o=!1!==n.component.startTracking()&&o),o},h.T,h.d)),o.pb(8,49152,null,0,a.m,[o.h,o.k,o.z],{color:[0,"color"],size:[1,"size"],type:[2,"type"]},null),(n()(),o.qb(9,0,null,0,1,"ion-icon",[["name","locate"]],null,null,null,h.hb,h.r)),o.pb(10,49152,null,0,a.E,[o.h,o.k,o.z],{name:[0,"name"]},null),(n()(),o.Ib(-1,0,[" Start "])),(n()(),o.qb(12,0,null,0,4,"ion-button",[["color","tertiary"],["size","default"],["type","button"]],null,[[null,"click"]],function(n,t,l){var o=!0;return"click"===t&&(o=!1!==n.component.stopTracking()&&o),o},h.T,h.d)),o.pb(13,49152,null,0,a.m,[o.h,o.k,o.z],{color:[0,"color"],size:[1,"size"],type:[2,"type"]},null),(n()(),o.qb(14,0,null,0,1,"ion-icon",[["name","hand"]],null,null,null,h.hb,h.r)),o.pb(15,49152,null,0,a.E,[o.h,o.k,o.z],{name:[0,"name"]},null),(n()(),o.Ib(-1,0,[" Stop "])),(n()(),o.qb(17,0,null,0,4,"ion-button",[["color","tertiary"],["size","default"],["type","button"]],null,[[null,"click"]],function(n,t,l){var o=!0;return"click"===t&&(o=!1!==n.component.GetLocations()&&o),o},h.T,h.d)),o.pb(18,49152,null,0,a.m,[o.h,o.k,o.z],{color:[0,"color"],size:[1,"size"],type:[2,"type"]},null),(n()(),o.qb(19,0,null,0,1,"ion-icon",[["name","hand"]],null,null,null,h.hb,h.r)),o.pb(20,49152,null,0,a.E,[o.h,o.k,o.z],{name:[0,"name"]},null),(n()(),o.Ib(-1,0,[" GetLocations\n"])),(n()(),o.qb(22,0,null,0,4,"ion-list-header",[],null,null,null,h.pb,h.A)),o.pb(23,49152,null,0,a.R,[o.h,o.k,o.z],null,null),(n()(),o.qb(24,0,null,0,2,"ion-label",[],null,null,null,h.ob,h.y)),o.pb(25,49152,null,0,a.P,[o.h,o.k,o.z],null,null),(n()(),o.Ib(-1,0,["Previous Tracks History"])),(n()(),o.qb(27,0,null,0,4,"ion-grid",[],null,null,null,h.fb,h.p)),o.pb(28,49152,null,0,a.C,[o.h,o.k,o.z],null,null),(n()(),o.hb(16777216,null,0,2,null,A)),o.pb(30,278528,null,0,f.k,[o.P,o.L,o.s],{ngForOf:[0,"ngForOf"]},null),o.Cb(131072,f.b,[o.h])],function(n,t){var l=t.component;n(t,3,0),n(t,8,0,"tertiary","default","button"),n(t,10,0,"locate"),n(t,13,0,"tertiary","default","button"),n(t,15,0,"hand"),n(t,18,0,"tertiary","default","button"),n(t,20,0,"hand"),n(t,30,0,o.Jb(t,30,0,o.Ab(t,31).transform(l.locations)))},null)}function I(n){return o.Kb(0,[(n()(),o.qb(0,0,null,null,1,"app-location-tracking",[],null,null,null,G,O)),o.pb(1,114688,null,0,p,[a.Kb,a.Nb,i.a,w.b,r.a,u.a,L.a,C.a,c.b],null,null)],function(n,t){n(t,1,0)},null)}var E=o.mb("app-location-tracking",p,I,{},{},[]),P=l("gIcY"),N=l("Hf/j"),R=l("qxEu");l.d(t,"LocationTrackingPageModuleNgFactory",function(){return x});var x=o.nb(b,[],function(n){return o.xb([o.yb(512,o.j,o.cb,[[8,[d.a,E]],[3,o.j],o.x]),o.yb(4608,f.n,f.m,[o.u,[2,f.t]]),o.yb(4608,P.t,P.t,[]),o.yb(4608,a.c,a.c,[o.z,o.g]),o.yb(4608,a.Jb,a.Jb,[a.c,o.j,o.q]),o.yb(4608,a.Ob,a.Ob,[a.c,o.j,o.q]),o.yb(1073742336,f.c,f.c,[]),o.yb(1073742336,P.r,P.r,[]),o.yb(1073742336,P.e,P.e,[]),o.yb(1073742336,a.Fb,a.Fb,[]),o.yb(1073742336,y.q,y.q,[[2,y.w],[2,y.m]]),o.yb(1073742336,N.f,N.f,[]),o.yb(1073742336,R.a,R.a,[]),o.yb(1073742336,b,b,[]),o.yb(1024,y.k,function(){return[[{path:"",component:p}]]},[])])})}}]);