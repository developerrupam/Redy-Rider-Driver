(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{bNZI:function(n,t,o){"use strict";o.r(t);var e=o("CcnG"),l=o("mrSG"),i=o("gTw3"),a=o("ZZ/e"),r=o("23JA"),s=o("UNbJ"),c=o("k82s"),u=o("67Y/"),d=function(){function n(n,t,o,e,l,i,a,r,s){var c=this;this.navCtrl=n,this.plt=t,this.geolocation=o,this.storage=e,this.nativeGeocoder=l,this.backgroundGeolocation=i,this.afAuth=a,this.afs=r,this.localNotifications=s,this.arr=[],this.user=null,this.currentMapTrack=null,this.markers=[],this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[],this.loc=[],this.geoencoderOptions={useLocale:!0,maxResults:5},console.log("constructor"),this.storage.get("USER_INFO").then(function(n){n&&c.anonLogin(n.user_account_no+"-"+n.name+"-"+new Date)})}return n.prototype.ngOnInit=function(){var n=this;console.log("ngOnInit"),this.backgroundGeolocation.configure({desiredAccuracy:10,stationaryRadius:20,interval:2e3,distanceFilter:30,debug:!0,stopOnTerminate:!1}).then(function(){n.backgroundGeolocation.on(s.b.location).subscribe(function(t){console.log(t),n.addLocation(t),n.backgroundGeolocation.finish()})})},n.prototype.ionViewDidEnter=function(){console.log("ionViewDidEnter"),this.plt.ready().then(function(){})},n.prototype.ionViewWillEnter=function(){console.log("ionViewWillEnter"),this.loadMap()},n.prototype.loadMap=function(){var n=this;this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:-34.9011,lng:-56.1645},zoom:20,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0}),this.geolocation.getCurrentPosition().then(function(t){var o={lat:t.coords.latitude,lng:t.coords.longitude},e=new google.maps.Marker({position:o,map:n.map,title:"you are here!"});n.markers.push(e),n.map.setCenter(o),n.map.setZoom(13)}).catch(function(n){console.log("Error getting location",n)})},n.prototype.anonLogin=function(n){var t=this;this.afAuth.auth.signInAnonymously().then(function(o){t.locationsCollection=t.afs.collection("locations/"+n+"/track",function(n){return n.orderBy("timestamp")}),t.locations=t.locationsCollection.snapshotChanges().pipe(Object(u.a)(function(n){return n.map(function(n){var t=n.payload.doc.data();return l.__assign({id:n.payload.doc.id},t)})})),console.log("this.locations",t.locations),t.locations.subscribe(function(n){console.log("new location: ",n),t.loc=n,t.updateMap(n)})})},n.prototype.updateMap=function(n){if(n.length>1){this.markers.map(function(n){return n.setMap(null)}),this.markers=[];for(var t=0,o=n;t<o.length;t++){var e=o[t],l=new google.maps.LatLng(e.lat,e.lng),i=new google.maps.Marker({map:this.map,position:l});this.markers.push(i)}}},n.prototype.addNewLocation=function(n,t,o,e){this.locationsCollection.add({lat:n,lng:t,timestamp:o,address:e})},n.prototype.deleteLocation=function(n){this.locationsCollection.doc(n.id).delete()},n.prototype.registerNotification=function(n){this.localNotifications.schedule({title:"my "+n+" notification",text:"Saha Local Notification",trigger:{in:n,unit:c.a.SECOND}})},n.prototype.startTracking=function(){var n=this;this.backgroundGeolocation.start();var t=1;this.trackedRoute=[],this.watch=this.geolocation.watchPosition({frequency:3e3,enableHighAccuracy:!0}).subscribe(function(o){console.log("new position: ",o),o&&(n.getGeoencoder(o.coords.latitude,o.coords.longitude),console.log("geoaddress",n.geoAddress),n.addNewLocation(o.coords.latitude,o.coords.longitude,o.timestamp,n.geoAddress?n.geoAddress:"from desktop"),n.trackedRoute.push({lat:o.coords.latitude,lng:o.coords.longitude,address:n.geoAddress,point_number:t}),t++,n.redrawPath(n.trackedRoute))})},n.prototype.addLocation=function(n){this.getGeoencoder(n.latitude,n.longitude),this.trackedRoute=[],this.addNewLocation(n.latitude,n.longitude,n.time,this.geoAddress?this.geoAddress:"from desktop"),this.trackedRoute.push({lat:n.latitude,lng:n.longitude,address:this.geoAddress}),this.redrawPath(this.trackedRoute)},n.prototype.stopTracking=function(){this.backgroundGeolocation.stop()},n.prototype.GetLocations=function(){this.redrawPath(this.loc)},n.prototype.getGeoencoder=function(n,t){var o=this;console.log("latitude",n),this.nativeGeocoder.reverseGeocode(n,t,this.geoencoderOptions).then(function(n){console.log("result[0]",n[0]),o.geoAddress=o.generateAddress(n[0]),console.log("this.geoAddress",o.geoAddress)}).catch(function(n){alert("Error getting location"+JSON.stringify(n))})},n.prototype.generateAddress=function(n){console.log("addressObj",n);var t=[],o="";for(var e in n)t.push(n[e]);for(var l in t.reverse(),t)t[l].length&&(o+=t[l]+", ");return console.log("address.slice(0, -2);",o.slice(0,-2)),o.slice(0,-2)},n.prototype.redrawPath=function(n){console.log("path",n),this.currentMapTrack&&this.currentMapTrack.setMap(null),n.length>1&&(console.log("currentMapTrack"),this.currentMapTrack=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#7044ff",strokeOpacity:1,strokeWeight:3}),this.currentMapTrack.setMap(this.map),console.log("dfddsfsdsf"))},n.prototype.showHistoryRoute=function(n){console.log(n),this.redrawPath(n)},n}(),p=function(){return function(){}}(),g=o("pMnS"),h=o("bAmN"),b=o("jWFl"),f=o("OOyK"),m=o("ZYCi"),k=o("iw74"),y=o("jKJn"),w=o("xoVG"),v=o("Ht5U"),M=o("ZgVV"),A=o("cGva"),C=o("oBZk"),O=o("ZBkt"),G=o("fvl4"),q=e.ob({encapsulation:0,styles:[["#map[_ngcontent-%COMP%]{width:100%;height:550px}#markerLayer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{animation:.5s infinite alternate pulse;-webkit-animation:.5s infinite alternate pulse;transform-origin:center;-webkit-transform-origin:center}.footer-bus-route-details[_ngcontent-%COMP%]{background:#0a5999;color:#fff;text-align:center;padding:0 10px}ion-toolbar[_ngcontent-%COMP%]{--background:transparent;--color:white}"],h.a],data:{}});function T(n){return e.Hb(0,[e.Eb(402653184,1,{mapElement:0}),(n()(),e.qb(1,0,null,null,1,"app-header",[],null,null,null,b.b,b.a)),e.pb(2,114688,null,0,f.a,[m.m,a.f,k.b,y.a,w.a,v.a,M.a,A.a],null,null),(n()(),e.qb(3,0,null,null,2,"ion-content",[],null,null,null,C.cb,C.k)),e.pb(4,49152,null,0,a.w,[e.h,e.k,e.z],null,null),(n()(),e.qb(5,0,[[1,0],["map",1]],0,0,"div",[["id","map"]],null,null,null,null,null)),(n()(),e.qb(6,0,null,null,15,"ion-footer",[["class","footer-bus-route-details"]],null,null,null,C.hb,C.p)),e.pb(7,49152,null,0,a.B,[e.h,e.k,e.z],null,null),(n()(),e.qb(8,0,null,0,13,"ion-grid",[["no-margin",""],["no-paading",""]],null,null,null,C.ib,C.q)),e.pb(9,49152,null,0,a.C,[e.h,e.k,e.z],null,null),(n()(),e.qb(10,0,null,0,11,"ion-row",[["no-margin",""],["text-center",""]],null,null,null,C.zb,C.H)),e.pb(11,49152,null,0,a.kb,[e.h,e.k,e.z],null,null),(n()(),e.qb(12,0,null,0,4,"ion-col",[["no-margin",""],["style","padding: 10px;border-right: 2px solid white;"]],null,[[null,"click"]],function(n,t,o){var e=!0;return"click"===t&&(e=!1!==n.component.startTracking()&&e),e},C.bb,C.j)),e.pb(13,49152,null,0,a.v,[e.h,e.k,e.z],null,null),(n()(),e.qb(14,0,null,0,1,"ion-icon",[["name","locate"]],null,null,null,C.kb,C.s)),e.pb(15,49152,null,0,a.E,[e.h,e.k,e.z],{name:[0,"name"]},null),(n()(),e.Gb(-1,0,[" Start "])),(n()(),e.qb(17,0,null,0,4,"ion-col",[["no-margin",""],["style","padding: 10px;"]],null,[[null,"click"]],function(n,t,o){var e=!0;return"click"===t&&(e=!1!==n.component.stopTracking()&&e),e},C.bb,C.j)),e.pb(18,49152,null,0,a.v,[e.h,e.k,e.z],null,null),(n()(),e.qb(19,0,null,0,1,"ion-icon",[["name","hand"]],null,null,null,C.kb,C.s)),e.pb(20,49152,null,0,a.E,[e.h,e.k,e.z],{name:[0,"name"]},null),(n()(),e.Gb(-1,0,[" Stop "]))],function(n,t){n(t,2,0),n(t,15,0,"locate"),n(t,20,0,"hand")},null)}function E(n){return e.Hb(0,[(n()(),e.qb(0,0,null,null,1,"app-location-tracking",[],null,null,null,T,q)),e.pb(1,114688,null,0,d,[a.Kb,a.Nb,i.a,k.b,r.a,s.a,O.a,G.a,c.b],null,null)],function(n,t){n(t,1,0)},null)}var L=e.mb("app-location-tracking",d,E,{},{},[]),N=o("Ip0R"),P=o("gIcY"),x=o("Hf/j"),R=o("qxEu");o.d(t,"LocationTrackingPageModuleNgFactory",function(){return j});var j=e.nb(p,[],function(n){return e.xb([e.yb(512,e.j,e.cb,[[8,[g.a,L]],[3,e.j],e.x]),e.yb(4608,N.l,N.k,[e.u,[2,N.t]]),e.yb(4608,P.t,P.t,[]),e.yb(4608,a.c,a.c,[e.z,e.g]),e.yb(4608,a.Jb,a.Jb,[a.c,e.j,e.q]),e.yb(4608,a.Ob,a.Ob,[a.c,e.j,e.q]),e.yb(1073742336,N.b,N.b,[]),e.yb(1073742336,P.r,P.r,[]),e.yb(1073742336,P.e,P.e,[]),e.yb(1073742336,a.Fb,a.Fb,[]),e.yb(1073742336,m.q,m.q,[[2,m.w],[2,m.m]]),e.yb(1073742336,x.f,x.f,[]),e.yb(1073742336,R.a,R.a,[]),e.yb(1073742336,p,p,[]),e.yb(1024,m.k,function(){return[[{path:"",component:d}]]},[])])})}}]);