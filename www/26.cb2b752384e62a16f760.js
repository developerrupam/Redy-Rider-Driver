(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{bNZI:function(t,n,o){"use strict";o.r(n);var i=o("CcnG"),l=o("mrSG"),a=o("gTw3"),e=o("ZZ/e"),r=o("23JA"),c=o("UNbJ"),s=o("k82s"),u=o("67Y/"),p=function(){function t(t,n,o,i,l,a,e,r,c,s){var u=this;this.navCtrl=t,this.plt=n,this.geolocation=o,this.storage=i,this.nativeGeocoder=l,this.backgroundGeolocation=a,this.afAuth=e,this.afs=r,this.localNotifications=c,this.route=s,this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0}),this.DirectionsWaypoint=[],this.arr=[],this.user=null,this.currentMapTrack=null,this.markers=[],this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[],this.loc=[],this.geoencoderOptions={useLocale:!0,maxResults:5},this.stoppage_list=[],this.start_location="",this.end_location="",this.car_type="",console.log("constructor"),this.car_id=this.route.snapshot.params.car_id,this.storage.get("car_details").then(function(t){t&&t.forEach(function(t){t.car_id==u.car_id&&(console.log(t),u.stoppage_list=t.stoppage_list,u.start_location=t.start_location,u.end_location=t.end_location,u.car_type=t.car_type,u.loadMap({lat:parseFloat(t.start_lat),lng:parseFloat(t.start_long)},{lat:parseFloat(t.end_lat),lng:parseFloat(t.end_long)}),t.stoppage_list_1.forEach(function(t){var n;n={location:{lat:parseFloat(t.location.lat),lng:parseFloat(t.location.lng)},stopover:!0},u.DirectionsWaypoint.push(n)}))})}),this.storage.get("USER_INFO").then(function(t){t&&u.anonLogin(t.user_account_no+"-"+t.name+"-"+new Date)})}return t.prototype.ngOnInit=function(){var t=this;console.log("ngOnInit"),this.backgroundGeolocation.configure({desiredAccuracy:10,stationaryRadius:20,interval:2e3,distanceFilter:30,debug:!0,stopOnTerminate:!1}).then(function(){t.backgroundGeolocation.on(c.b.location).subscribe(function(n){console.log(n),t.driver_current_lat=n.latitude,t.driver_current_lng=n.longitude,t.update_driver_cordinated_to_firebase(),t.backgroundGeolocation.finish()})})},t.prototype.ionViewDidEnter=function(){console.log("ionViewDidEnter"),this.plt.ready().then(function(){})},t.prototype.ionViewWillEnter=function(){console.log("ionViewWillEnter")},t.prototype.loadMap=function(t,n){var o=this;this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:-34.9011,lng:-56.1645},zoom:19,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0}),this.geolocation.getCurrentPosition().then(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude};o.driver_marker=new google.maps.Marker({position:n,map:o.map,icon:"http://tobuekalabya.com/carservice_manage/icon/car_top.png",title:"you are here!"}),o.map.setCenter(n)}).catch(function(t){console.log("Error getting location",t)}),this.directionsDisplay.setMap(this.map),console.log("start_loc",this.start_location),this.location_source=t,this.location_destination=n,this.calculateAndDisplayRoute()},t.prototype.calculateAndDisplayRoute=function(){var t=this,n=this;n.directionsService.route({origin:this.location_source,destination:this.location_destination,travelMode:"DRIVING",waypoints:this.DirectionsWaypoint},function(o,i){"OK"===i?(n.directionsDisplay.setDirections(o),t.stoppage_list.forEach(function(n){var o,i={lat:parseFloat(n.lat),lng:parseFloat(n.lng)},l=new google.maps.InfoWindow({content:String(n.location_name)});o=new google.maps.Marker({position:i,map:t.map,icon:n.icon,title:"you are here!"}),1!=n.start&&1!=n.stop||l.open(t.map,o)})):window.alert("Directions request failed due to "+i)})},t.prototype.anonLogin=function(t){var n=this;this.afAuth.auth.signInAnonymously().then(function(o){n.locationsCollection=n.afs.collection("locations/"+t+"/track",function(t){return t.orderBy("timestamp")}),n.locations=n.locationsCollection.snapshotChanges().pipe(Object(u.a)(function(t){return t.map(function(t){var n=t.payload.doc.data();return l.__assign({id:t.payload.doc.id},n)})})),console.log("this.locations",n.locations),n.locations.subscribe(function(t){console.log("new location: ",t),n.loc=t})})},t.prototype.registerNotification=function(t){this.localNotifications.schedule({title:"my "+t+" notification",text:"Saha Local Notification",trigger:{in:t,unit:s.a.SECOND}})},t.prototype.startTracking=function(){var t=this;this.geolocation.getCurrentPosition().then(function(n){var o={};o.lat=n.coords.latitude,o.long=n.coords.longitude,o.name="";var i=t.car_type+"-"+t.car_id;t.afs.collection("locations").doc(i).set(o)}).catch(function(t){console.log("Error getting location",t)}),this.backgroundGeolocation.start();var n=1;this.trackedRoute=[],this.watch=this.geolocation.watchPosition({frequency:3e3,enableHighAccuracy:!0}).subscribe(function(o){if(console.log("new position: ",o),o){t.trackedRoute.push({lat:o.coords.latitude,lng:o.coords.longitude,address:t.geoAddress,point_number:n}),n++,t.driver_current_lat=o.coords.latitude,t.driver_current_lng=o.coords.longitude;var i=new google.maps.LatLng(t.driver_current_lat,t.driver_current_lng);console.log(i),t.driver_marker.setPosition(i),t.map.panTo(i),t.update_driver_cordinated_to_firebase()}})},t.prototype.update_driver_cordinated_to_firebase=function(){var t={};t.lat=this.driver_current_lat,t.long=this.driver_current_lng,t.name="test1.03.2020";var n=this.car_type+"-"+this.car_id;this.afs.collection("locations").doc(n).update(t)},t.prototype.stopTracking=function(){this.backgroundGeolocation.stop(),this.watch.unsubscribe();var t=this.car_type+"-"+this.car_id;this.afs.collection("locations").doc(t).delete()},t}(),d=function(){return function(){}}(),g=o("pMnS"),h=o("bAmN"),b=o("jWFl"),f=o("OOyK"),_=o("ZYCi"),m=o("iw74"),y=o("jKJn"),k=o("xoVG"),v=o("Ht5U"),w=o("ZgVV"),D=o("cGva"),q=o("oBZk"),E=o("ZBkt"),M=o("fvl4"),O=i.ob({encapsulation:0,styles:[["#map[_ngcontent-%COMP%]{width:100%;height:550px}#markerLayer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{animation:.5s infinite alternate pulse;-webkit-animation:.5s infinite alternate pulse;transform-origin:center;-webkit-transform-origin:center}.footer-bus-route-details[_ngcontent-%COMP%]{background:#0a5999;color:#fff;text-align:center;padding:0 10px}ion-toolbar[_ngcontent-%COMP%]{--background:transparent;--color:white}"],h.a],data:{}});function C(t){return i.Hb(0,[i.Eb(402653184,1,{mapElement:0}),(t()(),i.qb(1,0,null,null,1,"app-header",[],null,null,null,b.b,b.a)),i.pb(2,114688,null,0,f.a,[_.m,e.f,m.b,y.a,k.a,v.a,w.a,D.a],null,null),(t()(),i.qb(3,0,null,null,2,"ion-content",[],null,null,null,q.bb,q.j)),i.pb(4,49152,null,0,e.w,[i.h,i.k,i.z],null,null),(t()(),i.qb(5,0,[[1,0],["map",1]],0,0,"div",[["id","map"]],null,null,null,null,null)),(t()(),i.qb(6,0,null,null,15,"ion-footer",[["class","footer-bus-route-details"]],null,null,null,q.gb,q.o)),i.pb(7,49152,null,0,e.B,[i.h,i.k,i.z],null,null),(t()(),i.qb(8,0,null,0,13,"ion-grid",[["no-margin",""],["no-paading",""]],null,null,null,q.hb,q.p)),i.pb(9,49152,null,0,e.C,[i.h,i.k,i.z],null,null),(t()(),i.qb(10,0,null,0,11,"ion-row",[["no-margin",""],["text-center",""]],null,null,null,q.zb,q.H)),i.pb(11,49152,null,0,e.kb,[i.h,i.k,i.z],null,null),(t()(),i.qb(12,0,null,0,4,"ion-col",[["no-margin",""],["style","padding: 10px;border-right: 2px solid white;"]],null,[[null,"click"]],function(t,n,o){var i=!0;return"click"===n&&(i=!1!==t.component.startTracking()&&i),i},q.ab,q.i)),i.pb(13,49152,null,0,e.v,[i.h,i.k,i.z],null,null),(t()(),i.qb(14,0,null,0,1,"ion-icon",[["name","locate"]],null,null,null,q.jb,q.r)),i.pb(15,49152,null,0,e.E,[i.h,i.k,i.z],{name:[0,"name"]},null),(t()(),i.Gb(-1,0,[" Start "])),(t()(),i.qb(17,0,null,0,4,"ion-col",[["no-margin",""],["style","padding: 10px;"]],null,[[null,"click"]],function(t,n,o){var i=!0;return"click"===n&&(i=!1!==t.component.stopTracking()&&i),i},q.ab,q.i)),i.pb(18,49152,null,0,e.v,[i.h,i.k,i.z],null,null),(t()(),i.qb(19,0,null,0,1,"ion-icon",[["name","hand"]],null,null,null,q.jb,q.r)),i.pb(20,49152,null,0,e.E,[i.h,i.k,i.z],{name:[0,"name"]},null),(t()(),i.Gb(-1,0,[" Stop "]))],function(t,n){t(n,2,0),t(n,15,0,"locate"),t(n,20,0,"hand")},null)}function F(t){return i.Hb(0,[(t()(),i.qb(0,0,null,null,1,"app-location-tracking",[],null,null,null,C,O)),i.pb(1,114688,null,0,p,[e.Kb,e.Nb,a.a,m.b,r.a,c.a,E.a,M.a,s.b,_.a],null,null)],function(t,n){t(n,1,0)},null)}var G=i.mb("app-location-tracking",p,F,{},{},[]),x=o("Ip0R"),I=o("gIcY"),T=o("Hf/j"),A=o("qxEu");o.d(n,"LocationTrackingPageModuleNgFactory",function(){return N});var N=i.nb(d,[],function(t){return i.xb([i.yb(512,i.j,i.cb,[[8,[g.a,G]],[3,i.j],i.x]),i.yb(4608,x.l,x.k,[i.u,[2,x.t]]),i.yb(4608,I.t,I.t,[]),i.yb(4608,e.c,e.c,[i.z,i.g]),i.yb(4608,e.Jb,e.Jb,[e.c,i.j,i.q]),i.yb(4608,e.Ob,e.Ob,[e.c,i.j,i.q]),i.yb(1073742336,x.b,x.b,[]),i.yb(1073742336,I.r,I.r,[]),i.yb(1073742336,I.e,I.e,[]),i.yb(1073742336,e.Fb,e.Fb,[]),i.yb(1073742336,_.q,_.q,[[2,_.w],[2,_.m]]),i.yb(1073742336,T.f,T.f,[]),i.yb(1073742336,A.a,A.a,[]),i.yb(1073742336,d,d,[]),i.yb(1024,_.k,function(){return[[{path:"",component:p}]]},[])])})}}]);